
# 构建与打包全流程（Windows）

## 环境准备
- 安装 Visual Studio 2022（含 C++ 桌面开发组件）
- 安装 Qt 6.8.3（MSVC 2022 64 位），并确保 `CMakeLists.txt` 中的 `CMAKE_PREFIX_PATH` 指向 `C:/Qt/6.8.3/msvc2022_64`
- 安装 `vcpkg` 并准备依赖（示例路径）：
  - Opus：`G:/rust_projects/vcpkg/installed/x64-windows-static-md/share/opus`
  - libvpx：`G:/rust_projects/vcpkg/installed/x64-windows-static-md/share/unofficial-libvpx`
  - libyuv：`G:/rust_projects/vcpkg/installed/x64-windows-static-md/share/libyuv`
- 可选安装 NSIS（生成安装器 `.exe`）：若安装在 `C:/Program Files (x86)/NSIS/`，工程已自动识别。

## 首次配置与构建
在 `build` 目录执行：

```powershell
PS G:\c\2025\lunzi\IrulerDeskpro\build> cmake ..
PS G:\c\2025\lunzi\IrulerDeskpro\build> cmake --build . --config Release
```

说明：
- 第一次或修改代码/依赖后需要执行这两步以生成可执行文件并触发 `windeployqt` 将 Qt 依赖拷贝到 `build/bin/Release`。
- 构建成功后，主程序位于：`build/bin/Release/ScreenStreamApp.exe`。

## 运行主程序

```powershell
PS G:\c\2025\lunzi\IrulerDeskpro\build> .\bin\Release\irulerdesk.exe
```

## 打包（两种方案）

1) 安装向导（NSIS）：

```powershell
PS G:\c\2025\lunzi\IrulerDeskpro\build> cpack -G NSIS -C Release
```

- 输出：`build/IrulerDeskPro-0.1.0-win64.exe`
- 默认安装目录：`C:\Program Files\IrulerDeskPro`
- 开始菜单会创建入口；许可页为英文 EULA；官网链接：`http://www.iruler.cn/`

2) 便携包（ZIP）：

```powershell
PS G:\c\2025\lunzi\IrulerDeskpro\build> cpack -G ZIP -C Release
```

- 输出：`build/IrulerDeskPro-0.1.0-win64.zip`
- 解压后运行 `irulerdesk.exe`

## 一条命令同时构建并打包

```powershell
PS G:\c\2025\lunzi\IrulerDeskpro\build> cmake --build . --target package --config Release
```

## 常见问题与提示
- 未见到 Qt DLL/插件：先执行 `cmake --build . --config Release`，以便运行 `windeployqt` 部署依赖到 `build/bin/Release`
- NSIS 未安装：安装至默认目录后可直接 `cpack -G NSIS -C Release`
- 安装路径“下一步”灰色：使用合法路径（示例：`C:\Program Files\IrulerDeskPro`），避免混用正/反斜杠
- 图标与开始菜单：`src/maps/logo/iruler.ico` 用作应用与安装器图标；开始菜单创建“IrulerDeskPro”入口
