# å±å¹•æµåª’ä½“ç³»ç»Ÿ API æ–‡æ¡£

## ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºQtå’ŒWebSocketçš„å®æ—¶å±å¹•æµåª’ä½“ç³»ç»Ÿï¼Œæ”¯æŒé«˜æ•ˆçš„VP9è§†é¢‘ç¼–ç å’Œè§£ç ã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŒ…å«å¤šä¸ªç‹¬ç«‹çš„è¿›ç¨‹ç»„ä»¶ï¼Œå¯ä»¥çµæ´»é›†æˆåˆ°å„ç§åº”ç”¨åœºæ™¯ä¸­ã€‚

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CaptureProcess â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  PlayerProcess  â”‚
â”‚                 â”‚   (VP9 Stream)   â”‚                 â”‚
â”‚ â€¢ å±å¹•æ•è·      â”‚                  â”‚ â€¢ VP9è§£ç        â”‚
â”‚ â€¢ VP9ç¼–ç        â”‚                  â”‚ â€¢ è§†é¢‘æ˜¾ç¤º      â”‚
â”‚ â€¢ WebSocketæœåŠ¡ â”‚                  â”‚ â€¢ WebSocketå®¢æˆ·ç«¯â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                                     â–²
        â”‚                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ScreenStreamAppâ”‚                  â”‚   ç¬¬ä¸‰æ–¹åº”ç”¨    â”‚
â”‚                 â”‚                  â”‚                 â”‚
â”‚ â€¢ ä¸»æ§åˆ¶ç•Œé¢    â”‚                  â”‚ â€¢ è‡ªå®šä¹‰é›†æˆ    â”‚
â”‚ â€¢ è¿›ç¨‹ç®¡ç†      â”‚                  â”‚ â€¢ APIè°ƒç”¨       â”‚
â”‚ â€¢ çŠ¶æ€ç›‘æ§      â”‚                  â”‚ â€¢ æ•°æ®å¤„ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶

### 1. CaptureProcess (æ•è·è¿›ç¨‹)

**åŠŸèƒ½**: å±å¹•æ•è·ã€VP9ç¼–ç ã€WebSocketæœåŠ¡å™¨

- ğŸ“„ [è¯¦ç»†APIæ–‡æ¡£](./CaptureProcess_API.md)
- ğŸš€ å¯åŠ¨: `./CaptureProcess.exe`
- ğŸŒ WebSocket: `ws://localhost:8765`
- ğŸ“Š æ€§èƒ½: 30fps, VP9ç¼–ç 

### 2. PlayerProcess (æ’­æ”¾è¿›ç¨‹)

**åŠŸèƒ½**: VP9è§£ç ã€è§†é¢‘æ˜¾ç¤ºã€WebSocketå®¢æˆ·ç«¯

- ğŸ“„ [è¯¦ç»†APIæ–‡æ¡£](./PlayerProcess_API.md)
- ğŸš€ å¯åŠ¨: `./PlayerProcess.exe [ws://server:port]`
- ğŸ¥ æ˜¾ç¤º: å®æ—¶è§†é¢‘æ’­æ”¾çª—å£
- ğŸ“Š æ€§èƒ½: ä½å»¶è¿Ÿè§£ç æ˜¾ç¤º

### 3. ScreenStreamApp (ä¸»åº”ç”¨)

**åŠŸèƒ½**: é›†æˆç•Œé¢ã€è¿›ç¨‹ç®¡ç†ã€çŠ¶æ€ç›‘æ§

- ğŸš€ å¯åŠ¨: `./ScreenStreamApp.exe`
- ğŸ›ï¸ ç•Œé¢: Qt GUIæ§åˆ¶é¢æ¿
- ğŸ“Š ç›‘æ§: å®æ—¶çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

1. **å¯åŠ¨å®Œæ•´ç³»ç»Ÿ**:
   ```bash
   ./ScreenStreamApp.exe
   ```

2. **ç‹¬ç«‹å¯åŠ¨ç»„ä»¶**:
   ```bash
   # å¯åŠ¨æ•è·æœåŠ¡
   ./CaptureProcess.exe
   
   # å¯åŠ¨æ’­æ”¾å™¨ (å¦ä¸€ä¸ªç»ˆç«¯)
   ./PlayerProcess.exe
   ```

### ç¼–ç¨‹é›†æˆ

#### C++ Qt é›†æˆç¤ºä¾‹

```cpp
#include <QProcess>
#include <QWebSocket>

class StreamingSystem : public QObject {
    Q_OBJECT
    
public:
    void startSystem() {
        // å¯åŠ¨æ•è·è¿›ç¨‹
        m_captureProcess = new QProcess(this);
        m_captureProcess->start("./CaptureProcess.exe");
        
        // ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨åè¿æ¥
        QTimer::singleShot(2000, [this]() {
            m_webSocket = new QWebSocket();
            connect(m_webSocket, &QWebSocket::binaryMessageReceived,
                    this, &StreamingSystem::processFrame);
            m_webSocket->open(QUrl("ws://localhost:8765"));
        });
    }
    
private slots:
    void processFrame(const QByteArray &frameData) {
        // å¤„ç†VP9ç¼–ç çš„å¸§æ•°æ®
        // å¯ä»¥ä¿å­˜åˆ°æ–‡ä»¶ã€è½¬å‘åˆ°å…¶ä»–å®¢æˆ·ç«¯ç­‰
    }
    
private:
    QProcess *m_captureProcess;
    QWebSocket *m_webSocket;
};
```

#### Python é›†æˆç¤ºä¾‹

```python
import asyncio
import websockets
import subprocess

class StreamingClient:
    async def start_streaming(self):
        # å¯åŠ¨æ•è·è¿›ç¨‹
        self.capture_process = subprocess.Popen(['./CaptureProcess.exe'])
        
        # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
        await asyncio.sleep(2)
        
        # è¿æ¥å¹¶æ¥æ”¶æ•°æ®
        async with websockets.connect('ws://localhost:8765') as websocket:
            async for message in websocket:
                await self.process_frame(message)
    
    async def process_frame(self, frame_data):
        # å¤„ç†VP9å¸§æ•°æ®
        print(f"æ¥æ”¶åˆ°å¸§æ•°æ®: {len(frame_data)} å­—èŠ‚")
```

## æ•°æ®æ ¼å¼è§„èŒƒ

### WebSocket æ•°æ®æµ

```
æ–¹å‘: CaptureProcess â†’ Client
æ ¼å¼: äºŒè¿›åˆ¶æ•°æ® (Binary)
å†…å®¹: VP9ç¼–ç çš„è§†é¢‘å¸§
é¢‘ç‡: ~30fps
å¤§å°: å˜é•¿ (é€šå¸¸1KB-50KB)
```

### VP9 å¸§ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VP9 Header    â”‚ â† å¸§å¤´ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Compressed    â”‚ â† å‹ç¼©çš„å›¾åƒæ•°æ®
â”‚   Frame Data    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ€§èƒ½æŒ‡æ ‡

| ç»„ä»¶ | CPUä½¿ç”¨ç‡ | å†…å­˜ä½¿ç”¨ | ç½‘ç»œå¸¦å®½ | å»¶è¿Ÿ |
|------|-----------|----------|----------|------|
| CaptureProcess | ä¸­ç­‰ | 50-100MB | 1-10Mbps | <100ms |
| PlayerProcess | ä½-ä¸­ç­‰ | 30-80MB | - | <50ms |
| æ€»ç³»ç»Ÿ | ä¸­ç­‰ | 80-180MB | 1-10Mbps | <150ms |

## éƒ¨ç½²æŒ‡å—

### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10/11 (x64)
- **å†…å­˜**: æœ€å°‘1GBå¯ç”¨å†…å­˜
- **ç½‘ç»œ**: æœ¬åœ°å›ç¯æˆ–å±€åŸŸç½‘
- **æƒé™**: å±å¹•æ•è·æƒé™

### æ–‡ä»¶ç»“æ„

```
ScreenStreamApp/
â”œâ”€â”€ ScreenStreamApp.exe     # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ CaptureProcess.exe      # æ•è·è¿›ç¨‹
â”œâ”€â”€ PlayerProcess.exe       # æ’­æ”¾è¿›ç¨‹
â”œâ”€â”€ WebSocketServerProcess.exe # ç‹¬ç«‹WebSocketæœåŠ¡å™¨(å¯é€‰)
â”œâ”€â”€ Qt6Core.dll            # Qtè¿è¡Œæ—¶åº“
â”œâ”€â”€ Qt6WebSockets.dll      # WebSocketåº“
â”œâ”€â”€ vpx.dll                # VP9ç¼–è§£ç åº“
â””â”€â”€ api/                   # APIæ–‡æ¡£
    â”œâ”€â”€ README.md
    â”œâ”€â”€ CaptureProcess_API.md
    â””â”€â”€ PlayerProcess_API.md
```

### ç½‘ç»œé…ç½®

- **é»˜è®¤ç«¯å£**: 8765
- **åè®®**: WebSocket (ws://)
- **åœ°å€**: localhost (æœ¬åœ°) æˆ– LAN IP (å±€åŸŸç½‘)
- **é˜²ç«å¢™**: éœ€è¦å…è®¸8765ç«¯å£é€šä¿¡

## æ‰©å±•å¼€å‘

### è‡ªå®šä¹‰å®¢æˆ·ç«¯å¼€å‘

1. **è¿æ¥WebSocketæœåŠ¡å™¨** (`ws://localhost:8765`)
2. **æ¥æ”¶äºŒè¿›åˆ¶æ•°æ®** (VP9ç¼–ç å¸§)
3. **ä½¿ç”¨VP9è§£ç å™¨è§£ç **
4. **æ˜¾ç¤ºæˆ–å¤„ç†è§£ç åçš„å›¾åƒ**

### æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€

- âœ… C++ (Qt)
- âœ… Python (websockets, opencv-python)
- âœ… JavaScript (WebSocket API)
- âœ… C# (.NET WebSocket)
- âœ… Java (WebSocketå®¢æˆ·ç«¯)

### ç¬¬ä¸‰æ–¹åº“æ¨è

| è¯­è¨€ | WebSocketåº“ | VP9è§£ç åº“ |
|------|-------------|----------|
| Python | `websockets` | `opencv-python` |
| JavaScript | åŸç”ŸWebSocket | `broadway.js` |
| C# | `ClientWebSocket` | `FFMpegCore` |
| Java | `Java-WebSocket` | `JAVE2` |

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**: ç¡®ä¿8765ç«¯å£æœªè¢«å ç”¨
2. **æƒé™é—®é¢˜**: ç¡®ä¿æœ‰å±å¹•æ•è·æƒé™
3. **é˜²ç«å¢™é˜»æ­¢**: å…è®¸åº”ç”¨ç¨‹åºé€šè¿‡é˜²ç«å¢™
4. **ä¾èµ–åº“ç¼ºå¤±**: ç¡®ä¿æ‰€æœ‰DLLæ–‡ä»¶å­˜åœ¨

### è°ƒè¯•æ¨¡å¼

å¯åŠ¨æ—¶ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬:
- ç»„ä»¶å¯åŠ¨çŠ¶æ€
- WebSocketè¿æ¥ä¿¡æ¯
- ç¼–è§£ç ç»Ÿè®¡
- é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯

## ç‰ˆæœ¬å†å²

- **v1.0** (2025-01): åˆå§‹ç‰ˆæœ¬
  - VP9ç¼–è§£ç æ”¯æŒ
  - WebSocketé€šä¿¡
  - åŸºæœ¬GUIç•Œé¢
  - æ¨¡å—åŒ–æ¶æ„

## è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨çš„å¼€æºç»„ä»¶:
- Qt 6.8.3 (LGPL)
- libvpx (BSD)
- WebSocketåè®® (RFC 6455)

## æŠ€æœ¯æ”¯æŒ

å¦‚éœ€æŠ€æœ¯æ”¯æŒæˆ–æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒ:
1. ğŸ“– æœ¬APIæ–‡æ¡£
2. ğŸ› æ—¥å¿—è¾“å‡ºä¿¡æ¯
3. ğŸ”§ ç³»ç»Ÿè¦æ±‚æ£€æŸ¥
4. ğŸ“§ æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼